$(function(){var j;var k;var l=$('#tw');var m=$('#d');var n=$('#t');var o=$('#av');var p=$('#n');var q=$('#me');var r=$('#m');var s=$('#sw');var t=$('.so');var u=$('#cu');var v=$('#u');var z=$("#c");var A;var B;var C;var D=0.1;var E;var F;var G=true;var H=100;var I=1;function init(){j=new Twitter();j.getFriends('statuses/friends.json?screen_name=robhawkes');updateCanvasDimensions();E=new Boundary(0,0,B,A);initEventListeners();timeout()};function initEventListeners(){$(window).bind('resize',updateCanvasDimensions).bind('keyup',onKeyUp).bind('mousemove',onMove);$(z).add('#tw').bind('click',onClick);$(document).bind('onFriendsReceived',function(e){k=e.response;F=new PointCollection();for(var i=0;i<k.length;i++){if(k[i].status){var a=F.newPoint(Math.random()*B,Math.random()*A);a.data=k[i]}};v.val('');changeSort(3);t.removeClass('active');$('.so3').addClass('active')});u.bind('submit',changeUser);v.add(p).bind('click',function(e){e.stopPropagation()});t.bind('click',function(e){e.stopPropagation();t.removeClass('active');$(this).addClass('active');changeSort($(this).attr('class').match(/so([0-9]+)/i)[1])});$('#o').click(function(e){s.fadeIn(500)})};function updateCanvasDimensions(){z.attr({height:($(window).height()>600)?$(window).height():'600',width:($(window).width()>740)?$(window).width():'740'});B=z.width();A=z.height();if(E)E.setBoundary(0,0,B,A);draw()};function onKeyUp(e){switch(e.keyCode){case 32:hideTweetWrapper();if(s.is(':hidden')){s.fadeIn(500)}else{s.fadeOut(500)}break}};function onMove(e){if(F)F.mousePos.set(e.pageX,e.pageY)};function onClick(e){e.stopPropagation();F.selectedPoint=null;var a=F.selectPoint(e.pageX,e.pageY);if(a){a.colour={r:150,g:150,b:150};var b=a.data;p.html('<a href="http://twitter.com/'+b.screen_name+'" target="_blank">'+b.name+' (@'+b.screen_name+')</a>');var c=new Date(b.status.created_at);var d=new Date();var f=Math.ceil((d.getTime()-c.getTime())/(1000*60*60*24));var g=(f>1)?'s':'';q.html('Tweets: '+b.statuses_count+' &ndash; '+'Followers: '+b.followers_count+' &ndash; '+'Following: '+b.friends_count+' &ndash; Last tweet sent: '+f+' day'+g+' ago');o.attr('src',b.profile_image_url);n.html(b.status.text);m.css('marginTop',(A/2)-(m.height()/2));l.css({visibility:'visible',display:'none'}).fadeIn(500)}else{hideTweetWrapper()}};function hideTweetWrapper(){l.fadeOut(500,function(){$(this).css({visibility:'hidden',display:'block'})})}function changeUser(e){e.preventDefault();r.fadeIn(600);j.getFriends('statuses/friends.json?screen_name='+v.val())};function changeSort(h){if(!G){s.fadeOut(500)}else{G=false};r.fadeIn(600,function(){var a;var b=0,ratio=0;for(var i=0;i<F.points.length;i++){var c=F.points[i];if(c==null)continue;var d=c.data;switch(parseInt(h)){case 1:a=d.followers_count;break;case 2:a=d.friends_count;break;case 3:a=d.statuses_count;break;case 4:var e=new Date(d.created_at);var f=new Date();var g=1000*60*60*24;a=Math.ceil((f.getTime()-e.getTime())/g);break;case 5:a=d.listed_count;break};c.originalSize=c.size=a;b=(a>b)?a:b};ratio=(H+I)/b;for(var i=0;i<F.points.length;i++){var c=F.points[i];if(c==null)continue;var d=c.data;c.originalSize=c.size=c.size*ratio+I};r.fadeOut(600)})};function timeout(){draw();update();setTimeout(function(){timeout()},30)};function draw(){var a=z.get(0);if(a.getContext==null){return};C=a.getContext('2d');C.clearRect(0,0,B,A);if(F)F.draw()};function update(){if(F)F.update()};function Twitter(){this.apiUrl='http://api.twitter.com/1/';this.getFriends=function(b){b+='&include_entities=1&callback=?';$.getJSON(this.apiUrl+b,function(a){$.event.trigger({type:'onFriendsReceived',response:a})})}};function Vector(x,y){this.x=x;this.y=y;this.addX=function(x){this.x+=x};this.addY=function(y){this.y+=y};this.set=function(x,y){this.x=x;this.y=y}};function Boundary(x,y,w,h){this.left=x;this.right=w;this.top=y;this.bottom=h;this.setBoundary=function(x,y,w,h){this.left=x;this.right=w;this.top=y;this.bottom=h};this.collision=function(a){var b=false;var c=false;var d=false;if(a.curPos.x<this.left-a.size){a.curPos.x=this.right+a.size;b=true;c=true}else if(a.curPos.x>this.right+a.size){a.curPos.x=this.left-a.size;b=true;c=true};if(a.curPos.y<this.top-a.size){a.curPos.y=this.bottom+a.size;b=true;d=true}else if(a.curPos.y>this.bottom+a.size){a.curPos.y=this.top-a.size;b=true;d=true};return{collide:b,x:c,y:d}}};function PointCollection(){this.mousePos=new Vector(0,0);this.points=new Array();this.newPoint=function(x,y){var a=new Point(x,y);this.points.push(a);return a};this.selectPoint=function(x,y){var a=this.points.length;for(var i=0;i<a;i++){var b=this.points[i];if(b==null)continue;var c=b.curPos.x-x;var e=b.curPos.y-y;var f=(c*c)+(e*e);var d=Math.sqrt(f);if(d<b.size){this.selectedPoint=b;return b}}};this.update=function(){var a=this.points.length;for(var i=0;i<a;i++){var b=this.points[i];if(b==null)continue;b.force=new Vector(0.0,0.0)};for(var i=0;i<a;i++){var b=this.points[i];if(b==null)continue;var c=this.mousePos.x-b.curPos.x;var e=this.mousePos.y-b.curPos.y;var f=(c*c)+(e*e);var d=Math.sqrt(f);if(d<100&&b.originalSize<10){var g=b.originalSize/(d/100);b.size=(g<10)?g:10}else{b.size=b.originalSize};b.update()}};this.draw=function(){var a=this.points.length;for(var i=0;i<a;i++){var b=this.points[i];if(b==null)continue;b.draw()}}};function Point(x,y){this.acceleration=new Vector(0.0,0.0);this.colour={r:0,g:0,b:0};this.curPos=new Vector(x,y);this.data=new Object();this.force=new Vector(0.0,0.0);this.mass=1.0;this.originalSize=5;this.size=5;this.velocity=new Vector(Math.random()*20-10,Math.random()*20-10);this.update=function(){E.collision(this);var a=D*D;this.curPos.x+=this.velocity.x*D+this.acceleration.x/2*a;this.curPos.y+=this.velocity.y*D+this.acceleration.y/2*a;this.velocity.x+=this.acceleration.x*D/2;this.velocity.y+=this.acceleration.y*D/2;this.acceleration.x=this.force.x/this.mass;this.acceleration.y=this.force.y/this.mass;this.velocity.x+=this.acceleration.x*D/2;this.velocity.y+=this.acceleration.y*D/2};this.draw=function(){C.fillStyle='rgb('+this.colour.r+', '+this.colour.g+', '+this.colour.b+')';C.beginPath();C.arc(this.curPos.x,this.curPos.y,this.size,0,Math.PI*2,true);C.fill()}};init()});